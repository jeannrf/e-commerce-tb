---
import { ShoppingCart, Heart } from "lucide-astro";

interface Props {
  name: string;
  price: number;
  image?: string;
  category?: string;
  isNew?: boolean;
  oldPrice?: number;
}

const {
  name,
  price,
  image,
  category = "Camiseta",
  isNew = false,
  oldPrice,
} = Astro.props;

const whatsappMessage = encodeURIComponent(
  `¬°Hola Tribuna SVR! üôã‚Äç‚ôÇÔ∏è Me interesa el producto: ${name} (S/. ${price}). ¬øEst√° disponible?`,
);
const whatsappLink = `https://wa.me/51982089087?text=${whatsappMessage}`;
---

<article
  class="group bg-white rounded-2xl overflow-hidden shadow-card card-hover animate-on-scroll"
>
  <!-- Image Container -->
  <div
    class="relative img-zoom aspect-square bg-gradient-to-br from-bg-alt to-white"
  >
    {
      image ? (
        <img
          src={image}
          alt={name}
          class="w-full h-full object-cover"
          loading="lazy"
        />
      ) : (
        <div class="w-full h-full flex items-center justify-center">
          <div class="text-6xl font-bold text-primary/10">AL</div>
        </div>
      )
    }

    <!-- Badges -->
    <div class="absolute top-3 left-3 flex flex-col gap-2">
      {
        isNew && (
          <span class="bg-accent-gold text-white px-3 py-1 rounded-full text-xs font-bold uppercase">
            Nuevo
          </span>
        )
      }
      {
        oldPrice && (
          <span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold uppercase">
            -{Math.round((1 - price / oldPrice) * 100)}%
          </span>
        )
      }
    </div>

    <!-- Quick Actions -->
    <div
      class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity"
    >
      <button
        class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-primary hover:text-white transition-colors"
        aria-label="Agregar a favoritos"
      >
        <Heart class="w-5 h-5" />
      </button>
    </div>

    <!-- Hover Overlay -->
    <div
      class="absolute inset-0 bg-primary/0 group-hover:bg-primary/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100"
    >
      <a
        href={whatsappLink}
        target="_blank"
        rel="noopener noreferrer"
        class="btn-primary inline-flex items-center gap-2 bg-primary text-white px-6 py-3 rounded-lg font-semibold transform scale-95 group-hover:scale-100 transition-transform"
      >
        <ShoppingCart class="w-5 h-5" />
        Lo quiero
      </a>
    </div>
  </div>

  <!-- Content -->
  <div class="p-5">
    <!-- Category -->
    <span class="text-xs font-medium text-text-muted uppercase tracking-wider">
      {category}
    </span>

    <!-- Name -->
    <h3
      class="text-lg font-bold text-text mt-1 group-hover:text-primary transition-colors line-clamp-2"
    >
      {name}
    </h3>

    <!-- Price -->
    <div class="flex items-center gap-2 mt-3">
      <span class="text-xl font-bold text-primary">
        S/. {price.toFixed(2)}
      </span>
      {
        oldPrice && (
          <span class="text-sm text-text-muted line-through">
            S/. {oldPrice.toFixed(2)}
          </span>
        )
      }
    </div>

    <!-- Mobile CTA -->
    <a
      href={whatsappLink}
      target="_blank"
      rel="noopener noreferrer"
      class="lg:hidden mt-4 btn-primary w-full inline-flex items-center justify-center gap-2 bg-primary text-white px-4 py-3 rounded-lg font-semibold"
    >
      <ShoppingCart class="w-4 h-4" />
      Lo quiero
    </a>
  </div>
</article>
